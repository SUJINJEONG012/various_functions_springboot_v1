<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="/admin/layout/basic">
<th:block layout:fragment="title">
	<title>글 수정 페이지</title>
</th:block>

<th:block layout:fragment="content">
	<div class="page_tits">
		<h3>게시판 관리</h3>
		<p class="path">
			<strong>현재위치 : </strong> <span>게시판 관리</span><span>리스트형</span><span>상세정보</span>
		</p>
	</div>

	<div class="content">

		<section>
			<form id="upateNoticeForm" method="post" aria-autocomplete="off"
				enctype="multipart/form-data">

				<input type="hidden" id="noticeId" th:value="${notice.noticeId}" />


				<div class="board">
					<div class="flex">
						<ul style="display: flex; align-content: space-between;">

							<li><h4>구분</h4>
								<p class="check input">

									<input type="checkbox" id="myCheckbox" class="custom-checkbox">
									<label th:text="${notice.noticeYn == false ? '일반' : '공지' }"></label>
								</p></li>

							<li>

								<h4>작성자</h4> <input type="text" id="writer" class="input"
								name="writer" th:value="${session.loginMember.memberName}"
								readonly />

							</li>

							<li><h4>등록일</h4> <input type="text" id="createdDate"
								lang="en" name="createdDate" class="input"
								th:value="${#temporals.format(notice.createdDate, 'yyyy-MM-dd HH:mm')}"
								readonly></li>

							<li>
								<h4 class="">조회</h4>
								<p lang="en" class="input">[[${notice.viewCnt}]]</p>
							</li>

						</ul>
					</div>



					<ul>

						<li><h4 class="">제목</h4> <input type="text"
							th:value="${notice.title}" name="title" /></li>

						<li class="textarea">
							<h4 class="">내용</h4> <textarea name="content"> [[${notice.content}]]</textarea>
						</li>


						<li>
							<!-- <h4 class="">첨부파일</h4> <div id="files"></div>
							<div class="file_list"></div>
							<button type="button" onclick="addFile();"
								class="btns fn_add_btn">
								<span>파일 추가</span>
							</button> -->
							
						
						<div class="file_list">
						<div id="files"></div>
							
						</div>
						</li>

					</ul>
				</div>

			</form>

			<p class="btn_set">
				<button type="button" id="updateNotice"
					class="btns btn_bdr4 btn_mid">수정</button>
				<button type="button" class="btns btn_bdr1 btn_mid">삭제</button>
				<a th:href="@{/admin/notice/list}" class="btns btn_bdr3 btn_mid">목록</a>
			</p>
		</section>
	</div>


</th:block>



<th:block layout:fragment="script">
	<script th:inline="javascript">

	document.addEventListener("DOMContentLoaded", function() {
		
	    let saveBtn = document.getElementById("updateNotice");
	    
	    saveBtn.addEventListener("click", function(e) {
	    
	    	let titleInput = document.querySelector('input[name="title"]');
		
			let contentInput = document.querySelector('textarea[name="content"]');
	    	console.log("titleInput : ",titleInput);
	    	
	    	if(titleInput && titleInput.value !== '' && contentInput && contentInput.value !== '') {
	    		// titleInput과 contentInput이 모두 존재하고 값이 있는 경우
	    	    // 이곳에서 formData에 추가하고 서버로 전송하는 코드를 작성합니다.
	    		let titleValue = titleInput.value;
	    		let contentValue = contentInput.value;
	    		console.log(titleValue);
	    		
	    		//formData 객체생성
	    		let formData = new FormData();
	    		formData.append('title', titleValue);
	    		formData.append('content', contentValue);
	    		
	    		const noticeId = document.getElementById('noticeId').value;
		    	console.log("noticeId : " + noticeId);
	            // Ajax 요청 보내기
	            /* $.ajax({
	                url: "/admin/notice/update/" + noticeId,
	                type: "PUT",
	                data: formData,
	              	processData: false,
	                contentType: false,
	               
	                success: function(response) {
	                    console.log("요청성공 : " +response);
	                    alert("요청성공!");
	                    alert("서버로부터와 응답데이터 : " + response);

	                    // ajax요청이 성공후 폼 데이터 초기화
	                    //document.getElementById("updateNoticeForm").reset();
	                },
	                error: function(xhr, status, error) {
						console.error("요청 실패 상태 코드:", xhr.status);
						    console.error("요청 실패 상태 텍스트:", xhr.statusText);
						    console.error("요청 실패 메시지:", xhr.responseText);
						    console.error("에러:", error);
	                }
	            }); */
	            
		    	$.ajax({
		    	    url: "/admin/notice/update/" + noticeId,
		    	    type: "PUT",
		    	    data: formData,
		    	    processData: false,
		    	    contentType: false,
		    	    success: function(response) {
		    	        console.log(response);
		    	        alert("요청성공!");
		    	        alert("서버로부터와 응답데이터 : " + response);

		    	        // ajax요청이 성공후 폼 데이터 초기화
		    	        document.getElementById("updateNoticeForm").reset();
		    	    },
		    	    error: function(xhr, status, error) {
		    	        console.error("요청 실패 상태 코드:", xhr.status);
		    	        console.error("요청 실패 상태 텍스트:", xhr.statusText);
		    	        console.error("요청 실패 메시지:", xhr.responseText);
		    	        console.error("에러:", error);
		    	    }
		    	});
	            
	        }else{
	        	console.error('title 또는 content 요소를 찾을 수 없습니다.');
	        	return;
	        }	      
	    });
	});
	    
		// 파일추가
		function addFile(){
			const fileDiv = document.createElement('div');
			
			fileDiv.innerHTML = `

			<li class="file_input">
							
							<span class="point_color">*</span> 파일
							<input type="file" name="files" class="input" lang="en" onchange="selectFile(this);" placeholder="">

			</li>
			 <button type="button" onclick="removeFile(this);" class="btns del_btn"><span>삭제</span></button>
			`;
			document.querySelector('.file_list').appendChild(fileDiv);
		}
		
		// 파일 선택 시 호출되는 함수
		function selectFile(input) {
		    const file = input.files[0]; // 첫 번째 파일만 선택
		    if (file) {
		        let formData = new FormData();
		        formData.append('file', file); // 'file'은 서버에서 파일을 받을 때 사용할 파라미터 이름
		        // 이어서 다른 필요한 데이터도 formData에 추가할 수 있음
		    }
		}
		

		// 파일 삭제
		function removeFile(element){
			const fileAddBtn = element.nextElementSibling;
			if(fileAddBtn){
				const inputs = element.previousElementSibling.querySelectorAll('input');
				inputs.forEach(input => input.value = '')
				return false;
			}
			element.parentElement.remove();
		}

		
		
	</script>
</th:block>

</html>