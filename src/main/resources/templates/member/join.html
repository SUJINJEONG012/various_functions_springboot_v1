<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<title>회원가입</title>
<link rel="stylesheet" th:href="@{/css/default.css}" />
<link rel="stylesheet" th:href="@{/css/common.css}" />
<link rel="stylesheet" th:href="@{/css/content.css}" />
<link rel="stylesheet" th:href="@{/css/button.css}" />
</head>

<body>

<!--	<div class="">
		<h3>회원가입</h3>
		<div class="">
			<form id="join_form" autocomplete="off" method="post">
				<table>
					<colgroup>
						<col style="width: 30%" />
						<col style="width: 30%" />
					</colgroup>
					<tbody>
						<tr>
							<th scope="row">아이디<span>필수입력</span></th>
							<td><input type="text" name="loginId" placeholder="아이디" maxlength="20" style="width: 80%;" />
								<button type="button" id="idCheckBtn" class="btns btn_st5"
									onclick="checkLoginId();" style="width: 20%; float: right">중복
									확인</button> <span class="id_input_re_1">사용 가능한 아이디입니다.</span> <span
								class="id_input_re_2">아이디가 이미 존재합니다.</span> <span
								class="final_id_ck">아이디를 입력해주세요.</span></td>
						</tr>
						<tr>
							<th scope="row">비밀번호<span class="es">필수입력</span></th>
							<td><input type="text" name="memberPw" placeholder="비밀번호"
								maxlength="30" /> <span class="final_pw_ck">비밀번호를
									입력해주세요.</span></td>

						</tr>
						<tr>
							<th scope="row">비밀번호 재입력<span class="es">필수 입력</span></th>
							<td><input type="text" name="passwordCheck"
								placeholder="비밀번호 재입력" maxlength="30" /> <span
								class="final_pwck_ck">비밀번호 확인을 입력해주세요.</span> <span
								class="pwck_input_re_1">비밀번호가 일치합니다.</span> <span
								class="pwck_input_re_2">비밀번호가 일치하지 않습니다.</span></td>
						</tr>

						<tr>
							<th scope="row">이름<span class="es">필수 입력</span></th>
							<td><input type="text" name="name" placeholder="이름"
								maxlength="10" /> <span class="final_name_ck">이름을
									입력해주세요.</span></td>
						</tr>

						<tr>
							<th scope="row">이메일<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberMail" placeholder="이메일"
								 />
								 <span class="final_mail_ck">이메일을 입력해주세요.</span> 
									
								<span class="mail_input_box_warn"></span>
								
								<div class="mail_check_wrap">
									<div class="mail_check_input_box"
										id="mail_check_input_box_false">
										<input class="mail_check_input">
									</div>
									<div class="mail_check_button">
										<span>인증번호 전송</span>
									</div>
									
									<span id="mail_check_input_box_warn"></span>
								</div>
								
								</td>
						</tr>

						<tr>
							<th scope="row">성별<span class="es">필수 입력</span></th>
							<td>
								<div class="radio_group">
									<p class="radios">
										<input type="radio" id="male" name="gender" value="M" checked />
										<label for="male">남</label><span class="check"></span>
									</p>
									<p class="radios">
										<input type="radio" id="female" name="gender" value="F" /> <label
											for="female">여</label><span class="check"></span>
									</p>
								</div>
							</td>
						</tr>

						<tr>
							<th scope="row">생년월일<span class="es">필수 입력</span></th>
							<td><input type="number" name="birthday"
								placeholder="숫자 8자리 입력" /></td>
						</tr>

						<tr class="address_wrap">
							<th>주소</th>
							<td class="address_input_1_box"><input
								class="address_input_1" name="memberAddr1" >
								<div class="address_button" onclick="execution_daum_address()">
									<span>주소 찾기</span>
								</div></td>
						</tr>

						<tr class="address_input_2_box">
							<th>상세주소</th>
							<td><input class="address_input_2" name="memberAddr2"
								> <span class="final_addr_ck">주소를
									입력해주세요.</span></td>

						</tr>

						<tr class="address_input_3_box">
							<th>상세주소</th>
							<td><input class="address_input_3" name="memberAddr3">
							<span class="final_addr_ck">주소를 입력해주세요.</span></td>
						</tr>

					</tbody>
				</table>
				<div class="join_button_wrap">
				 <input type="button" class="join_button" value="가입하기">
			</div>
			</form>
			
			
		</div>
	</div>-->
	
	
	<!--/* 회원가입 popup */-->
	<div id="signupPopup" class="">
		<h3>회원가입</h3>
		<div class="pop_container">
			<form id="signupForm" onsubmit="return false;" autocomplete="off">
				<table class="tb tb_row tl">
					<colgroup>
						<col style="width:30%;" /><col style="width:70%;" />
					</colgroup>
					<tbody>
						<tr>
							<th scope="row">아이디<span class="es">필수 입력</span></th>
							<td>
								<input type="text" name="loginId" id="loginId" placeholder="아이디" maxlength="20" style="width: 80%;" required/>
								<p id="idCheckMessage"></p>
								<button type="button" id="idCheckBtn" class="btns btn_st5" onclick="checkLoginId();" style="width: 20%; float: right;">중복 확인</button>
							</td>
						</tr>
						<tr>
							<th scope="row">비밀번호<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberPw" placeholder="비밀번호" maxlength="30" /></td>
						</tr>
						<tr>
							<th scope="row">비밀번호 재입력<span class="es">필수 입력</span></th>
							<td><input type="text" id="passwordCheck" name="passwordCheck" placeholder="비밀번호 재입력" maxlength="30" /></td>
						</tr>
						<tr>
							<th scope="row">이름<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberName" placeholder="이름" maxlength="10" /></td>
						</tr>
						<tr>
							<th scope="row">메일<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberMail" placeholder="이름"  /></td>
						</tr>
						<tr>
							<th scope="row">성별<span class="es">필수 입력</span></th>
							<td>
								<div class="radio_group">
									<p class="radios">
										<input type="radio" id="male" name="gender" value="M" checked />
										<label for="male">남</label><span class="check"></span>
									</p>
									<p class="radios">
										<input type="radio" id="female" name="gender" value="F" />
										<label for="female">여</label><span class="check"></span>
									</p>
								</div>
							</td>
						</tr>
						<tr>
							<th scope="row">생년월일<span class="es">필수 입력</span></th>
							<td><input type="number" name="birthday" placeholder="숫자 8자리 입력" /></td>
						</tr>
						<tr>
							<th scope="row">주소1<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberAddr1" placeholder="" /></td>
						</tr>
						<tr>
							<th scope="row">주소2<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberAddr2" placeholder="" /></td>
						</tr>
						<tr>
							<th scope="row">주소3<span class="es">필수 입력</span></th>
							<td><input type="text" name="memberAddr3" placeholder="" /></td>
						</tr>
					</tbody>
				</table>
			</form>
			<p class="btn_set">
				<button type="button" class="btns btn_st2" id="saveMember" onclick="saveMember();">가입</button>
				<button type="button" class="btns btn_bdr2" onclick="closeSignupPopup();">취소</button>
			</p>
		</div>
		<button type="button" class="btn_close" onclick="closeSignupPopup();"><span><i class="far fa-times-circle"></i></span></button>
	</div>


	<script th:src="@{/js/function.js}"></script>
	<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
	<script th:src="@{/js/common.js}"></script>
	<script src="https://kit.fontawesome.com/79613ae794.js" crossorigin="anonymous"></script>
	<script>
		/*$(document).ready(function() {
			//회원가입 버튼 (회원가입 기능 작동)
			$(".join_button").click(function() {
				alert("클릭버튼");
				$("#join_form").attr("action", "/member/join");
				$("#join_form").submit();
			});
		}); 
		*/
		/*
		document.addEventListener("DOMContentLoaded", () => {
			document.querySelector(".join_button").addEventListener("click", () => {
			document.querySelector("#join_form").action = "/member/join";
			document.querySelector("#join_form").submit();
		});
		});*/


		// 회원 정보 유효성 검사
		/*function validationMemberInfo(form) {

			const fields = form.querySelectorAll('input:not([type="radio"])');
			const fieldNames = ['아이디', '비밀번호', '이름', '생년월일'];

			for (let i = 0, len = fields.length; i < len; i++) {
				isValid(fields[i], fieldNames[i]);
			}
		}*/
		
		// 아이디 중복 체크 > 제이쿼리 버전
		/* function checkLoginId(){
			var loginId = $("#loginId").val();
			
			$.ajax({
				url: "/member/member-count",
				type:'GET',
				data : {loginId : loginId},
				success: function(response){
					alert("서버 응답 값 : " + response);
					if(response > 0){
						$("#idCheckMessage").text("이미 사용중인 아이디 입니다.");
						
					}else{
						$("#idCheckMessage").text("사용 가능한 아이디입니다.");
					}
				},
				error: function(xhr, status, error){
					alert("에러발생: "  + error);
				}
			})
		}*/
		
		// 아이디 중복 체크 > 순수자바스크립트 버전
		/*const checkLoginId = async () =>{
			const loginElement = document.getElementById("loginId");
			const loginId = loginElement.value;
			
			try{
				const response = await fetch(`/member/member-count?loginId=${loginId}`);
				const result = await response.json();
				alert(`서버 응답 값 : ${result}`);
				if(result > 0) {
					document.getElementById("idCheckMessage").innerText = "이미 사용중인 아이디입니다.";
				}else{
					document.getElementById("idCheckMessage").innerText = "사용 가능한 아이디입니다."
				}
			}catch(error){
				alert(`에러 발생 : ${error}`);
				}
		}*/
	
		// 회원 정보 저장 (회원가입)
		/*function saveMember() {
		
			var loginId = document.forms["signupForm"]["loginId"].value;
            var memberPw = document.forms["signupForm"]["memberPw"].value;
            var confirmPassword = document.forms["signupForm"]["confirmPassword"].value;
            var memberMail = document.forms["signupForm"]["memberMail"].value;
            
            // 아이디 중복 체크 (서버에서도 확인 필요)
            if (loginId.trim() === "") {
                alert("아이디를 입력하세요.");
                return false;
            }

            // 비밀번호와 비밀번호 확인이 일치하는지 확인
            if (memberPw !== confirmPassword) {
                alert("비밀번호와 비밀번호 확인이 일치하지 않습니다.");
                return false;
            }

            // 이메일 형식 검사
            var emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            if (!emailRegex.test(memberMail)) {
                alert("유효한 이메일 주소를 입력하세요.");
                return false;
            }
            
			// Save API 호출
			callApi('/member/join', 'post', params);
			alert('가입을 축하드립니다!\n로그인 후 서비스를 이용해 주세요.');
			
		}*/
		
		
// 중복 확인 결과 메시지 초기화
function clearIdCheckMessage() {
    document.getElementById("idCheckMessage").innerText = "";
}

// 아이디 중복 확인
const checkLoginId = async () => {
    const loginElement = document.getElementById("loginId");
    const loginId = loginElement.value;

    try {
        // 서버로 중복 확인 요청
        const response = await fetch(`/member/member-count?loginId=${loginId}`);
        const result = await response.json();

        if (result > 0) {
            document.getElementById("idCheckMessage").innerText = "이미 사용중인 아이디입니다.";
        } else {
            document.getElementById("idCheckMessage").innerText = "사용 가능한 아이디입니다.";
        }
    } catch (error) {
        console.error("에러 발생:", error);
    }
}

//유효성 검사
 function valid(){
	 // 폼 필드 값 가져오기
    let loginId = document.getElementById("loginId").value; // 유저가 입력한 값
    let memberPw = document.forms["signupForm"]["memberPw"].value;
    let confirmPassword = document.forms["signupForm"]["passwordCheck"].value;
    let memberMail = document.forms["signupForm"]["memberMail"].value;
    
      //정규식
    let loginIdReg = /^[a-z0-9]{4,12}$/; // 아이디 정규식코드

    // 아이디 중복 체크 (서버에서도 확인 필요)
    if ( !loginIdReg.test(loginId) || loginId.trim() === "") {
        alert("아이디를 형식에 맞게끔 입력해주세요.");
        document.getElementById("loginId").focus();
        document.getElementById("loginId").value= ""; 
        return false;
    }
    if (memberPw.trim() === "") {
        alert("비밀번호를 입력하세요.");
        return false;
    }

    // 비밀번호와 비밀번호 확인이 일치하는지 확인
    if (memberPw !== confirmPassword) {
        alert("비밀번호와 비밀번호 확인이 일치하지 않습니다.");
        return false;
    }
    

    // 이메일 형식 검사
    var emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
    if (!emailRegex.test(memberMail)) {
        alert("유효한 이메일 주소를 입력하세요.");
        return false;
    }

    // 중복 아이디 체크 결과 확인
    const idCheckMessage = document.getElementById("idCheckMessage").innerText;
    if (idCheckMessage !== "사용 가능한 아이디입니다.") {
        alert("아이디 중복을 확인하세요.");
        return false;
    }

 } 
 
// 회원 정보 저장 (회원가입)
function saveMember() {
  
   // 1. 필드 유효성 검사
    const form = document.getElementById("signupForm");
    valid(form);
   
   // 2. 파라미터 세팅
   const params = {};
   new FormData(form).forEach((value, key) =>{ 
	   params[key] = value.trim()
   
   });
   params.birthday = params.birthday.replace(/(\d{4})(\d{2})(\d{2})/g, '$1-$2-$3');
   
   
   // 3. Save API 호출
	callApi('/member/join', 'post', params);
    
    // 회원가입 성공 시 메시지 출력
    alert('가입을 축하드립니다!\n로그인 후 서비스를 이용해 주세요.');

    return false; // 폼의 기본 동작을 막기 위해 false 반환
}

// 이벤트 등록
document.getElementById("loginId").addEventListener("input", clearIdCheckMessage);
document.getElementById("idCheckBtn").addEventListener("click", checkLoginId);


		
	</script>
</body>
</html>