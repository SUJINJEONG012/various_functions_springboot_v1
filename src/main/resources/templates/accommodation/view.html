<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="/layout/basic">
<th:block layout:fragment="title">
	<title>글 상세페이지</title>
	
</th:block>


<th:block layout:fragment="content">
<!--
상단에 이미지 노출 
숙소이름  노출 
좌측에는 예약하기 금액 노출 박스로 
숙소소개 관련 글 

숙소위치는 지도로 노출
리뷰는나중에 노출하기 위해서 일단 보류

  -->
<style>
	.calendar {
	           display: inline-block;
	           margin: 10px;
	       }
	       .calendar-header {
	           display: flex;
	           justify-content: space-between;
	           align-items: center;
	       }
	       .days {
	           display: grid;
	           grid-template-columns: repeat(7, 1fr);
	           gap: 5px;
	       }
		   /* 날짜 스타일 */
		   .day {
		       display: inline-block;
		       width: 30px;
		       height: 30px;
		       line-height: 30px;
		       text-align: center;
		       cursor: pointer;
		   }
	       .day, .date {
	           text-align: center;
	           padding: 5px;
	       }
	       .date {
	           cursor: pointer;
	       }
		   /* 선택된 날짜 스타일 */
		   .day.selected {
		       background-color: #4caf50;
		       color: white;
		   }
	       .selected {
	           background-color: lightblue;
	       }
		   .day.disabled {
	           color: lightgray;
	           cursor: not-allowed;
	       }
		   /* 범위 표시 스타일 */
		   .day.range {
		       background-color: #81c784;
		       color: white;
		   }
		   
		   /* 공백 스타일 */
		   .day.empty {
		       visibility: hidden; /* 공백을 숨깁니다. */
		   }
</style>  
<div class="content">
	<h4>숙소리스트 </h4>
		
	<!-- 달력 -->
	    <div class="calendar" id="checkinCalendar">
	        <div class="calendar-header">
	            <div id="checkinMonthYear"></div>
	        </div>
	        <div class="days" id="checkinDays"></div>
	    </div>
	    
	    <div class="calendar" id="checkoutCalendar">
	        <div class="calendar-header">
				<div id="checkoutMonthYear"></div>
	            <button onclick="changeMonth(1, 'checkout')">&gt;</button>
	        </div>
	        <div class="days" id="checkoutDays"></div>
			
	    </div>
	   
	   
		<!-- 숙소 이미지 출력 -->
		<div class="row row-cols-1 row-cols-md-3 mb-3 text-center">
		  
			<div class="col">
		    <div class="card mb-4 rounded-3 shadow-sm">
		      <div class="card-header py-3">
		        <h4 th:text="${accommodation.accommodationName}"></h4>
		      </div>
		      <div class="card-body">
		        
		        <h1 class="card-title">
		        
		        <div th:each="room : ${accommodation.rooms}">
		        	<span th:utext="${room.RoomPeak} + '<span>원</span>' "></span>
		        </div>
				</h1>
				
				<!-- 
				이미지 주석처리하면에러안나오고 이미지부분에서 에러니옴-->
				<div id="files" th:each="file : ${files}">
					<img th:src="@{'/accommodation/' + ${accommodation.accommodationId} + '/files/' + ${file.afId} + '/list'}"
					alt="File Image" style="width: 50%;">
				</div> 
				
				

				<ul class=" mt-3 mb-4">
					<li th:text="${accommodation.accommodationCate}"></li>
					<li th:text="${accommodation.accommodationGrade + '등급'}"></li>
					<li th:text="${accommodation.accommodationDetail}"></li>
		        </ul>
				
		       <div>예약하기ㅇㅇㅇ</div>
		        
		      </div>
		    </div>
		  </div>
		  
		</div>
</div>
		
  
  
</th:block>
<th:block layout:fragment="script">
	<script th:inline="javascript">
		/*<![CDATA[*/
				window.onload = () => {
				//deleteNotice();
				findAllFile();
			}
			
		// 파일조회	
		function findAllFile(){
			
			const accommodationId = [[${accommodation.accommodationId}]];
			const response = getJson(`/accommodation/${accommodationId}/files`);
			
			if(!response.length){
				return false;
			}
			
			let fileHtml = '<div class="file_down"><div class="cont">';
			response.forEach(row => {
				if(row.originalName.match(/\.(jpeg|jpg|gif|png)$/) != null){
				fileHtml += `
					<img src="/accommodation/${accommodationId}/files/${row.afId}/view" alt="${row.originalName}" style="width: 100%; height: auto;">
				`
			}
				
			
			});
			fileHtml += '</div></div>';
			
			document.getElementById('files').innerHTML = fileHtml;
			
		}	
		
		// 달력
		let checkinDate = new Date();
		let checkoutDate = new Date(checkinDate.getFullYear(), checkinDate.getMonth() + 1, 1);
		
		let selectedCheckinDate = null;
		let selectedCheckoutDate = null;
		
		function updateCalendar(calendarType) {
		    let date, monthYearElement, daysElement, currentDate;
		
		    if (calendarType === 'checkin') {
		        date = checkinDate;
		        monthYearElement = document.getElementById('checkinMonthYear');
		        daysElement = document.getElementById('checkinDays');
		        currentDate = new Date(); // 현재 날짜
		    } else {
		        date = checkoutDate;
		        monthYearElement = document.getElementById('checkoutMonthYear');
		        daysElement = document.getElementById('checkoutDays');
		        currentDate = new Date(); // 현재 날짜
		    }
		
		    const year = date.getFullYear();
		    const month = date.getMonth();
		    const firstDay = new Date(year, month, 1).getDay();
		    const lastDate = new Date(year, month + 1, 0).getDate();
		
		    // 한글로 월과 연도 표시하기
		    const monthYearText = date.toLocaleDateString('ko-KR', { month: 'long', year: 'numeric' });
		    monthYearElement.textContent = monthYearText;
		
		    daysElement.innerHTML = '';
		
		    // 공백을 추가
		    for (let i = 0; i < firstDay; i++) {
		        const emptyDay = document.createElement('div');
		        emptyDay.classList.add('day', 'empty');
		        daysElement.appendChild(emptyDay);
		    }
		
		    // 현재 달 날짜 표시
		    for (let day = 1; day <= lastDate; day++) {
		        const dayElement = document.createElement('div');
		        dayElement.classList.add('day');
		        dayElement.textContent = day;
		
		        // 비활성화된 날짜를 클릭할 수 없게 하기
		        const dayDate = new Date(year, month, day);
		        if (dayDate < currentDate) {
		            dayElement.classList.add('disabled');
		            dayElement.onclick = () => {}; // 클릭 이벤트를 비활성화
		        } else {
		            dayElement.onclick = () => {
		                if (calendarType === 'checkin') {
		                    if (selectedCheckinDate === day) {
		                        selectedCheckinDate = null;
		                        dayElement.classList.remove('selected');
		                    } else {
		                        selectedCheckinDate = day;
		                        document.querySelectorAll('#checkinDays .day').forEach(el => el.classList.remove('selected', 'range'));
		                        dayElement.classList.add('selected');
		                        highlightRange();
		                    }
		                } else {
		                    if (selectedCheckoutDate === day) {
		                        selectedCheckoutDate = null;
		                        dayElement.classList.remove('selected');
		                    } else {
		                        selectedCheckoutDate = day;
		                        document.querySelectorAll('#checkoutDays .day').forEach(el => el.classList.remove('selected', 'range'));
		                        dayElement.classList.add('selected');
		                        highlightRange();
		                    }
		                }
		            };
		        }
		
		        if (calendarType === 'checkin' && selectedCheckinDate === day) {
		            dayElement.classList.add('selected');
		        }
		
		        if (calendarType === 'checkout' && selectedCheckoutDate === day) {
		            dayElement.classList.add('selected');
		        }
		
		        daysElement.appendChild(dayElement);
		    }
		}
		
		function highlightRange() {
		    const checkinDays = document.querySelectorAll('#checkinDays .day');
		    const checkoutDays = document.querySelectorAll('#checkoutDays .day');
		
		    let checkinStartIndex = -1;
		    let checkoutEndIndex = -1;
		
		    checkinDays.forEach((day, index) => {
		        if (day.classList.contains('selected')) {
		            checkinStartIndex = index;
		        }
		    });
		
		    checkoutDays.forEach((day, index) => {
		        if (day.classList.contains('selected')) {
		            checkoutEndIndex = index;
		        }
		    });
		
		    if (checkinStartIndex !== -1 && checkoutEndIndex !== -1) {
		        // 범위 초기화
		        document.querySelectorAll('#checkinDays .day').forEach(day => day.classList.remove('range'));
		        document.querySelectorAll('#checkoutDays .day').forEach(day => day.classList.remove('range'));
		
		        for (let i = checkinStartIndex; i < checkinDays.length; i++) {
		            const dayElement = checkinDays[i];
		            if (i >= checkinStartIndex) {
		                dayElement.classList.add('range');
		            }
		            if (i >= checkinStartIndex && i === checkoutEndIndex) {
		                break;
		            }
		        }
		
		        for (let i = 0; i <= checkoutEndIndex; i++) {
		            const dayElement = checkoutDays[i];
		            if (i <= checkoutEndIndex) {
		                dayElement.classList.add('range');
		            }
		        }
		    }
		}
		
		function changeMonth(delta, calendarType) {
		    if (calendarType === 'checkin') {
		        checkinDate.setMonth(checkinDate.getMonth() + delta);
		        updateCalendar('checkin');
		    } else {
		        checkoutDate.setMonth(checkoutDate.getMonth() + delta);
		        updateCalendar('checkout');
		    }
		}
		
		document.addEventListener('DOMContentLoaded', () => {
		    updateCalendar('checkin');
		    updateCalendar('checkout');
		});

				
				
				
		/*]]>*/
	</script>
	
	
</th:block>
</html>